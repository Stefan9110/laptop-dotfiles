#!/bin/sh

# Arguments
# $1 - project name
# $2 - project path

CONFIG_PATH="$XDG_CONFIG_HOME/cpp-init/"

if [ -z $1 ]; then
	printf "\033[1;31m✘  \033[0mYou haven't specified the project's name!\n"
	exit 1
fi

PROJECT_ROOT="$(pwd)/$1"
if [ ! -z $2 ] && [ -d $2 ]; then
	PROJECT_ROOT="$2"
fi

mkdir -p "$PROJECT_ROOT" "$PROJECT_ROOT/src" "$PROJECT_ROOT/include" "$PROJECT_ROOT/build"

if [ -f "$PROJECT_ROOT/src/$1.cpp" ] || [ -f "$PROJECT_ROOT/CMakeLists.txt" ]; then
	printf "\033[1;31m✘  \033[0mProject files already exist! Aborting...\n"
	exit 1
fi

echo "// Project generated by $(whoami) at $(date)" >>"$PROJECT_ROOT/src/$1.cpp"
cat "$CONFIG_PATH/template-source.cpp" >>"$PROJECT_ROOT/src/$1.cpp"
cp "$CONFIG_PATH/template-cmakelists.txt" "$PROJECT_ROOT/CMakeLists.txt"
sed -i "s/TEMPLATE_PROJECT_NAME/$1/g" "$PROJECT_ROOT/CMakeLists.txt"

printf "\033[1;36m  Successfully created project root and initialised files for $1!\033[0m\n"
